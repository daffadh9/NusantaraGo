<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Maps API Verification</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }
    h1 {
      font-size: 28px;
      color: #2d3748;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
    }
    .input-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 8px;
    }
    input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 10px;
      display: none;
    }
    .result.show {
      display: block;
    }
    .result.success {
      background: #c6f6d5;
      border: 2px solid #38a169;
      color: #22543d;
    }
    .result.error {
      background: #fed7d7;
      border: 2px solid #e53e3e;
      color: #742a2a;
    }
    .result h3 {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .icon {
      font-size: 24px;
    }
    #map {
      width: 100%;
      height: 300px;
      border-radius: 10px;
      margin-top: 20px;
      display: none;
    }
    #map.show {
      display: block;
    }
    .loading {
      text-align: center;
      color: #718096;
      padding: 20px;
      display: none;
    }
    .loading.show {
      display: block;
    }
    .spinner {
      border: 3px solid #e2e8f0;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .info {
      background: #bee3f8;
      border: 2px solid #3182ce;
      color: #2c5282;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .checklist {
      list-style: none;
      margin-top: 15px;
    }
    .checklist li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .checklist li::before {
      content: '‚úÖ';
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üó∫Ô∏è Google Maps API Tester</h1>
    <p class="subtitle">Verify your Google Maps API key is working</p>

    <div class="info">
      <strong>üìã Before testing:</strong>
      <ul class="checklist">
        <li>API key created in Google Cloud Console</li>
        <li>Maps JavaScript API enabled</li>
        <li>API key restrictions set (HTTP referrers)</li>
      </ul>
    </div>

    <form id="testForm">
      <div class="input-group">
        <label for="apiKey">Google Maps API Key:</label>
        <input 
          type="text" 
          id="apiKey" 
          placeholder="AIzaSyXXXXXXXXXXXXXXXXXXXXXX"
          required
        />
      </div>

      <button type="submit">üöÄ Test API Key</button>
    </form>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Testing API key...</p>
    </div>

    <div class="result" id="result"></div>
    <div id="map"></div>
  </div>

  <script>
    const form = document.getElementById('testForm');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const mapDiv = document.getElementById('map');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const apiKey = document.getElementById('apiKey').value.trim();
      
      if (!apiKey) {
        showResult('error', '‚ùå Error', 'Please enter an API key');
        return;
      }

      // Reset
      result.className = 'result';
      result.innerHTML = '';
      mapDiv.className = '';
      loading.classList.add('show');

      try {
        // Load Google Maps script
        await loadGoogleMaps(apiKey);
        
        // Try to initialize map
        const map = new google.maps.Map(mapDiv, {
          center: { lat: -6.2088, lng: 106.8456 }, // Jakarta
          zoom: 12
        });

        // Add marker
        new google.maps.Marker({
          position: { lat: -6.2088, lng: 106.8456 },
          map: map,
          title: 'Test Marker'
        });

        loading.classList.remove('show');
        mapDiv.classList.add('show');
        showResult('success', '‚úÖ Success!', 
          'Your API key is working correctly!<br><br>' +
          '<strong>What works:</strong><br>' +
          '‚úÖ API key is valid<br>' +
          '‚úÖ Maps JavaScript API is enabled<br>' +
          '‚úÖ Map loaded successfully<br>' +
          '‚úÖ Marker placed on map<br><br>' +
          '<strong>Next steps:</strong><br>' +
          '1. Copy this API key<br>' +
          '2. Add to .env file<br>' +
          '3. Restart dev server<br>' +
          '4. Test in your app!'
        );
      } catch (error) {
        loading.classList.remove('show');
        
        let errorMsg = 'Unknown error occurred';
        let troubleshoot = '';

        if (error.message.includes('RefererNotAllowedMapError')) {
          errorMsg = 'API key restrictions are blocking this domain';
          troubleshoot = `
            <strong>Fix:</strong><br>
            1. Go to Google Cloud Console ‚Üí Credentials<br>
            2. Edit your API key<br>
            3. Application restrictions: "HTTP referrers"<br>
            4. Add: *<br>
            5. Save and wait 2 minutes<br>
            6. Try again
          `;
        } else if (error.message.includes('ApiNotActivatedMapError')) {
          errorMsg = 'Maps JavaScript API is not enabled';
          troubleshoot = `
            <strong>Fix:</strong><br>
            1. Go to: https://console.cloud.google.com/apis/library<br>
            2. Search: "Maps JavaScript API"<br>
            3. Click ENABLE<br>
            4. Wait 1-2 minutes<br>
            5. Try again
          `;
        } else if (error.message.includes('InvalidKeyMapError')) {
          errorMsg = 'API key is invalid or malformed';
          troubleshoot = `
            <strong>Fix:</strong><br>
            1. Check API key is copied correctly<br>
            2. No extra spaces or characters<br>
            3. Key should start with "AIza"<br>
            4. Try generating a new key
          `;
        } else {
          errorMsg = error.message;
          troubleshoot = `
            <strong>General troubleshooting:</strong><br>
            1. Check billing is enabled<br>
            2. Check APIs are enabled<br>
            3. Check API key restrictions<br>
            4. Wait 2 minutes after changes<br>
            5. Try in incognito mode
          `;
        }

        showResult('error', '‚ùå Error', errorMsg + '<br><br>' + troubleshoot);
      }
    });

    function loadGoogleMaps(apiKey) {
      return new Promise((resolve, reject) => {
        // Check if already loaded
        if (window.google && window.google.maps) {
          resolve();
          return;
        }

        // Remove existing script if any
        const existing = document.querySelector('script[src*="maps.googleapis.com"]');
        if (existing) {
          existing.remove();
        }

        const script = document.createElement('script');
        script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}`;
        script.async = true;
        script.defer = true;

        script.onload = () => resolve();
        script.onerror = () => reject(new Error('Failed to load Google Maps script'));

        // Listen for Google Maps errors
        window.gm_authFailure = () => {
          reject(new Error('InvalidKeyMapError: The provided API key is invalid'));
        };

        document.head.appendChild(script);
      });
    }

    function showResult(type, title, message) {
      result.className = `result ${type} show`;
      result.innerHTML = `
        <h3><span class="icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>${title}</h3>
        <p>${message}</p>
      `;
    }
  </script>
</body>
</html>
